DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'DotCommerce.Persistence.SqlServer.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201504072138112_Initial'
BEGIN
    CREATE TABLE [dbo].[OrderLine] (
        [Id] [int] NOT NULL IDENTITY,
        [ProductId] [nvarchar](max),
        [ProductName] [nvarchar](max),
        [Order_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.OrderLine] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_Order_Id] ON [dbo].[OrderLine]([Order_Id])
    CREATE TABLE [dbo].[Order] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](max),
        [CreatedOn] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.Order] PRIMARY KEY ([Id])
    )
    ALTER TABLE [dbo].[OrderLine] ADD CONSTRAINT [FK_dbo.OrderLine_dbo.Order_Order_Id] FOREIGN KEY ([Order_Id]) REFERENCES [dbo].[Order] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201504072138112_Initial', N'DotCommerce.Persistence.SqlServer.Migrations.Configuration',  0x1F8B0800000000000400ED59CB6EE33614DD17E83F085AB545C64A329B36B06790DA49113489832833E86E404BD70E3114A992546AA3E89775D14FEA2FF4522F4BA46CCBCE4CA6288A6C223E0EEFE3DC07E9BFFFFC6BF8769930EF09A4A2828FFC93C1B1EF018F444CF962E4677AFEEA7BFFED9BAFBF1A5EC4C9D27B5FAD7B6DD6E14EAE46FEA3D6E95910A8E81112A206098DA45062AE07914802128BE0F4F8F887E0E4240084F011CBF386F719D73481FC033FC7824790EA8CB01B110353E538CE8439AA774B1250298960E44F841E8B240119C1E0CEC8A3340A0C83F0571682444D061788AD579712F7FC26E447DF3B6794A0A021B0B9EF11CE85261AD5387BA720D452F04598E200610FAB1470DD9C3005A57A67EBE57D353D3E359A06EB8D155494292D923D014F5E97A60BECED0739C0AF4D9B9B3D49192C8DDAB98547FE54C62043C4CF94EFD9079E8D99346BDB3E98E012CA078D9D479E3B7F5473072966FE8EBC71C6742661C421D392B023EF2E9B311AFD0CAB07F111F888678CF95ED014B8F0AC2DEF35E5D057DA2D8CA1A006355E5B87CE5D87AAD4500855C2B9D6000EDD499182D4AB7B98976A5EC56D43E0A2C0DE586F6BEC29F4BFE2FAF5A9EFDDE2E164C6A02678C356A116127E020E926888EF88D620B9C180DCE2CEE9D659F81967915E1F89618509C4F76EC8F21AF8423F8E7CFCD7F72EE912E26AA414E31DA7986F70939619F43CC97C7CFAB36EC9135DE406B14ECD69E17BF7C0F259F548D3229D1484F950D306A3E6528AE45EB06A5763EEC303910BD028B7D8B0201419D2CD227DB066FDEE58F89471F07F0CEC1303584CE40B0440959CCB636A0E56E38E86DBE1C6128CB6535E214EF0F3819AE8DA85B43D5ACA68786EC85411B13164AA98EA1332E74A8988E6F234456DCAD256F182C7DE2EC12C3FA0CB3100688A944709B0A3F26D6A4FF9041868F0CEA3A20B18131591D835306A11F796A7CE2D963C45716CCBF49D6DAE8661DC1483CD99C60A0EB2B4D964D6916490FD659E51258F6DC90D5408BA83236B67B982073D60364238DB1B7A5A182D3E36966DE2ACEDD41E4CA9655F8B1DEC015339D8862965B6B9D356B523386AB7AE9BEDA0E8B6ABAE3CD8D0960F6F489A62766BB4E9E58817163DFAF855B87F779A141841D4B2AE4DC2FA24CCD66401D62C1E8D925E52A93426323223266F8DE3C4598624DEC0ACEA0087A7AEAF2ACE555BCCFF658CEC7B496970DE3A676D5D5CBC48B018E5BA43170FDCBDF9158A30223B2AE358B02CE19BAAEBB6DD8D7EAF09D218DE1BABE8E83AD08A09176F185866B1FD13380E72D26BDBE5FD09F122643894082F4582AAE169225463FD511A0D4813A831FCF2AE6FE7CE0EFFB7AAC5B31DDD42EB1DDBA65674355E1DA5C735602F3A14705DEECC5B936AF7017295B5EC40B9F693C82E85AEC79D8A682FA9F9565746AB020ECB6AB4FBF5CA294FC512DF43D99F686C4A53B842DA2403B3C03067CC28327CBDE086703A07A58BDB947F7A7C726ABD70FD7B5E9B02A562D651CD3B5F705EFC4E488D5977DEFAF6BC50394F21FC89C8E891C86F12B2FCB60977E073C7B3F0D621DD3081D3CC5FF1189623FFF77CD39977F5CB876ADF9197FF77E61D7B7FEC30CD9EEF16FF0DEFB71F019EE52AE7661EE3A7DE7D33FF5C97DF2F7BD52D6E83075C6ECD8F0D3007691C4A18A678A5252679A765B89394473425ACA5B35BA1FAD0D02854E3D9331348811B7E39EAF5396C5B4DAE912DDBEED27FCFFBBF7BC3EA79D5DF7ED32F0A21D27C26D0D105BDF77C08D8FC0EB011FCCB3D11B837F9DDEF014D2B5ADDE167790070DB1A6453E3A73B24B3A28B3584F9218F43D4E251BDE68ACF4545684BA26A8995026F4013CC7AE45C6A3A2791C6E90894CA1F56DF1396E1928B6406F1159F663ACD34AA0CC98CB59E6A4D586C3B3F7FE568CB3C9CA6F993E5A75001C5A426714FF98F1965712DF76547E2DE0061E2AD2C51C697DA94AAC5AA46BA15B6F7370195E6ABD3C4032429433035E52179824364C37A770D0B12ADAAEE7433C86E47B4CD3E9C50B2C08B922A31D6FBF113391C27CB37FF00603E06CEC11E0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201504121216134_changes1'
BEGIN
    ALTER TABLE [dbo].[OrderLine] ADD [ItemId] [nvarchar](max)
    ALTER TABLE [dbo].[OrderLine] ADD [ItemName] [nvarchar](max)
    DECLARE @var0 nvarchar(128)
    SELECT @var0 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.OrderLine')
    AND col_name(parent_object_id, parent_column_id) = 'ProductId';
    IF @var0 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[OrderLine] DROP CONSTRAINT [' + @var0 + ']')
    ALTER TABLE [dbo].[OrderLine] DROP COLUMN [ProductId]
    DECLARE @var1 nvarchar(128)
    SELECT @var1 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.OrderLine')
    AND col_name(parent_object_id, parent_column_id) = 'ProductName';
    IF @var1 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[OrderLine] DROP CONSTRAINT [' + @var1 + ']')
    ALTER TABLE [dbo].[OrderLine] DROP COLUMN [ProductName]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201504121216134_changes1', N'DotCommerce.Persistence.SqlServer.Migrations.Configuration',  0x1F8B0800000000000400ED59CB6EE33614DD17E83F085AB545C64A329B36B06790DA49113489832833E86E404BD70E3114A992546AA3E89775D14FEA2FF4522F4BA46CCBCE4CA6280A6F248A3CBC8FC3FBA0FFFEF3AFE1DB65C2BC27908A0A3EF24F06C7BE073C1231E58B919FE9F9ABEFFDB76FBEFE6A7811274BEF7D35EFB599872BB91AF98F5AA76741A0A24748881A2434924289B91E442209482C82D3E3E31F8293930010C2472CCF1BDE675CD304F2177C1D0B1E41AA33C26E440C4C95E3F825CC51BD5B92804A4904237F22F4582409C8080677461EA551601884BFB210246A32B8406CBDBA94B8E637213FFADE39A304050D81CD7D8F702E34D1A8C6D93B05A196822FC21407087B58A580F3E6842928D53B5B4FEFABE9F1A9D134582FACA0A24C6991EC0978F2BA345D602F3FC8017E6DDADCEC49CA6069D4CE2D3CF2A7320619227EA67CCFDEF06CCCA499DBF6C104A7503E68AC3CF2DCEF4735779062E677E48D33A63309230E9996841D7977D98CD1E867583D888FC0473C63CCF782A6C085676D79AF2987BED26E610C0535A8F1DA3A74AE3A54A58642A8127E6B0DE0D09D142948BDBA8779A9E655DC36044E0AEC85F5B2C69A42FF2BAE5F9FFADE2D6E4E660C6A82376C156A21E127E0208986F88E680D921B0CC82DEEEC6EEFA52159EF87670AA387EFDD90E535F0857E1CF9F8E87B977409713552CAF08E530C36B848CB0CFA6C639E3EFD46B7E4892E7253585BE684F0BD7B60F957F548D322901454F9501306CFCBA514C9BD60D5AAC6B70F0F442E40A3DC62C384506448348BEEC19AEFBB4FC1A73C01FFB37F1FF6631A912FC0FE2A2C97DBD41CACC61D0DB7C38D25186DA7BC429CE0EB0335A76B17D2F6D3529E86E71E99EA446C3C32D599EA7364CE951211CDE5698ADA94A5ADE2058FBD5D82597E4097E301A029521E25C05ACAB7A93DE51360A0C13B8F8AFC3F262A22B16B60D422EE2D4F1D5B2C798AB4D896E93BDB5C0DC3B82106CB328DB91B6469B3C9AC23C820FBCB38A34A1EDB921BA810740747D6CE72050F7AC06C84709637F4B4305A7C6C4CDBC459DBA93D9852CBBE163BD803A672B00D53CA6C73A7AD6AC7E1A8DDBA2EB383A2CEAEEAF16043413EBC21698AD1AD51A097235E5854E7E357E1FE756952600451CBBA3609EB9D305A9305585F716B94F4924AA53190911931716B1C27CE3424F10666551B383C757D5571AE5A629ECB33B26F7BD2E0BCB5CFDABA3879916032CA75872E1EB86BF3E68930223B32E358B02CE19BB2EBD6D565A5D74228C7F643290A391BA71875918681650ADB2781E31427A4B6DDDC9F042F4280439DFF528EAF8A9C264235D61FA5517434811AC32FEFFA76BCECF07F2B433CDBD12DB4DEE7D9E487AE62AB23DDB806EC458702AECB9D793952AD3E40AE327F1D28D77E12D9E9CFF5B89305ED2935DFEA6C6865BD61998176DF553929A998E27B28FB138D4D3A0A57489B64602618E68C194586AF27DC104EE7A074D141F9A7C727A7D67DD6BFE76E29502A661D19BCF3BEE6C5FB406ACCBAB3D3DBB3896A5F7CF02722A34722BF49C8F2DB26D621971BCF025B1FE686F24EE97EC563588EFCDFF34567DED52F1FAA75475EFE74E61D7B7FEC30CA9EB714FF0DBFB75BFE67B9CAE9C3637CD5BBFBF0CFD5EA7ED9C6B6E8FD0E6865CD9F0A3007691C4A180677A5258677A758B89394473425ACA5B39B9BFAD0D02854E3D95F26900237FC72D4EBB3D9B66C5C235BB6DDA5FF9EDDBEDB4FF56CECB7F7F5450A449ACF043ABAA0F79E6DFFE6AE7F23F897BB1070FBF6DDDD7FD38A565DF859DA7DB7A0413635FEA243322BBA5843983FEC38442D1ED573AEF85C5484B624AAA65821F00634C1A847CEA5A6731269FC1C8152F935EA7BC2329C7291CC20BEE2D34CA79946952199B1D6C5AC3916DBF6CFEF34DA320FA7697E41F929544031A909DC53FE6346595CCB7DD911B8374098F356A628E34B6D52D5625523DD0ADBFB9B804AF3D561E201929421989AF2903CC121B261BEBB86058956555DBA1964B723DA661F4E2859608BA44A8CF57A7C450EC7C9F2CD3FBD1E3B3BA91E0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201504121218307_changes2'
BEGIN
    ALTER TABLE [dbo].[Order] ADD [Status] [nvarchar](max)
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201504121218307_changes2', N'DotCommerce.Persistence.SqlServer.Migrations.Configuration',  0x1F8B0800000000000400ED59CD6EE33610BE17E83B083AB545D672924B6BD8BB489DA4089AC441945DF416D0D2D821962255924A6D147DB21EFA487D850EF56789B463D9F9D9A2287C9128F2E3FC7CC3198EFFFEF3AFE18745C2BC47908A0A3EF20F7B7DDF031E8998F2F9C8CFF4ECDDF7FE87F75F7F353C8B9385F7A99A776CE6E14AAE46FE83D6E9200854F4000951BD8446522831D3BD482401894570D4EFFF101C1E0680103E6279DEF036E39A2690BFE0EB58F008529D1176256260AA1CC72F618EEA5D9304544A2218F9A7428F4592808CA07763E4511A05865EF82B0B41A226BD33C4D6CB73896B7E13F2B3EF9D304A50D010D8CCF708E742138D6A0C3E2A08B5147C1EA63840D8DD32059C37234C41A9DE6035BDABA6FD23A369B05A58414599D222D911F0F0B8345D602FDFCB017E6D5A346E6128A3756EE0913F9131C84BCA517B7BB7C1984933B3B30328A85E8D77E06D5D7550B30B49687E07DE38633A9330E2906949D88177934D198D7E86E59DF80C7CC433C69A0AA14AF8AD3580433752A420F5F21666A59A17B1EF05ED7581BDB05ED65853E87FC1F5F191EF5DE3E664CAA0E64BC356A116127E020E9268886F88D620B9C180DCE2CEEEF65E1A92D57E48510C46DFBB228B4BE073FD30F2F1D1F7CEE902E26AA494E123A718BBB848CB0CBA6C639E5E7EA36BF248E7B929AC2D7342F8DE2DB0FCAB7AA06911970555EE6BC228DC568AE456B06A55E3DBFD1D9173D028B7D83021141912AD2DD73058F17D7B14BC6404FCCFFE5DD88FA7B27C03F687286DA65E7D9BB104638509AF763AC5D73B6AA2CEB1E14E515446C97343A98A948DA154C55A97503A514A443497A7296A5396B68A673CF6B60956F8A7560C7D848141530C0594004B16DFA6FC849F02030DDE4954A4D9315111895D03A316716779EA33C792A748976D99BEB3CDD5308C7BF460F5A309A2C8D266A7D335870F464579FEA89278B6E4062A04BD86232B67B982071D60364238CB1B7A5A182D3E36A66DE2ACEDD40E4CA9655F891DEC005339D8862965B6B9D356754D70D46E5D55B34151CE56656FB0A1EE1D5E9134C5E3A8510797235E5814C1E377E1EEE55F526004915A5305D6D2D63BE1294EE6607DC5AD51D2732A95C6838C4C8939B7C671E24C43126F6056B581C353D75715E7AA25E6B98C915D6F010DCE5BFBACAC8B93E70926A95C7758C703776D7E47218CC83519732C5896F04D59F7C9D56505D84228C77643290A3C1BA71875918681650ADB2781E314E7486DBBB93B09DE8400FB3AFFAD1C5F153F4D846AAC3B4A55DB3451AAB1EE288DD2A509D4187E7B02B54FDD352C6AE59967D3A585D6F9543059665DC9B62669B906EC44AA026E1D29F2A2A65ABD875C6516DC53AEDD24B293A8EB712797DA536ABED539D5CA9DC3328F6D6F2C3989AD98E27B28FB238D4D520B97489BA4672618E68C194586AF265C114E67A074713FF38FFA874756F3E9DFD3080A948A59D76ED09BDF32A931EBD67BE4B60BD4936D15FE4864F440E43709597CDBC4DAA775F22CB055303794772E00173C86C5C8FF3D5F34F02E7EB9AFD61D78F9D3C0EB7B7F6C31CA8E3D90FF86DFDB0D8567B9AADD34781694D31888F1556F6F0CBCD6DDFBCBDEB48BCBE81E776BF36702CC401A6E10867942698999C2A93B6E24E5114D096BE9ECA6B92E8C360AD578F6975348811BAA3AEA75D9ECA9C45E235BB6DDA6FF8EED07F782D7B1D3F074A3A1C8A648F3A9404717F4DEB10FB1B90DB111FCCB7528DC46C2F67644D38A5689F92AFD07B736423635FE9A43322B3A5F41983FEA38442D1ED5732EF84C5484B624AAA65847E0156882A71E39919ACE48A4F173044AE58DD84F846538E52C99427CC127994E338D2A433265AD0EB2098BA7F6CF9B2C6D99879334EF98BE840A28263507F784FF985116D7729FAF39B8374098782BB39DF1A536596FBEAC91AE85EDFD4D40A5F9EA63E20E929421989AF0903CC23EB261EABC843989965589BB1964BB23DA661F9E5232C7DB962A3156EBF115391C278BF7FF00F91AB535A11E0000 , N'6.1.3-40302')
END


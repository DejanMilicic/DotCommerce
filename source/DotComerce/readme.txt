DotCommerce.SqlServer
=====================

Steps for integration of DotCommerce with SqlServer persistence layer into your project

1. Run script below to create tables needed for DotCommerce
2. Add connection string named "DotCommerce" to the web.config of the project
3. In Dependency injection configuration, register DotCommerceApi as implementing IDotCommerceApi
4. Implement IShippingCalculator and register in DependencyInjection
5. Since EF 6.1 created default configuration targeting local database, change this to
	<entityFramework>
		<defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" />
	</entityFramework>

=== TSQL ===

DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
	SELECT @CurrentMigration =
		(SELECT TOP (1) 
		[Project1].[MigrationId] AS [MigrationId]
		FROM ( SELECT 
		[Extent1].[MigrationId] AS [MigrationId]
		FROM [dbo].[__MigrationHistory] AS [Extent1]
		WHERE [Extent1].[ContextKey] = N'DotCommerce.Migrations.Configuration'
		)  AS [Project1]
		ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
	SET @CurrentMigration = '0'

IF @CurrentMigration < '201505121543188_Initial'
BEGIN
	CREATE TABLE [dbo].[OrderLine] (
		[Id] [int] NOT NULL IDENTITY,
		[ItemId] [nvarchar](max),
		[ItemName] [nvarchar](max),
		[ItemPrice] [decimal](18, 2) NOT NULL,
		[ItemDiscount] [decimal](18, 2) NOT NULL,
		[ItemWeight] [int] NOT NULL,
		[ItemUrl] [nvarchar](max),
		[ItemImageUrl] [nvarchar](max),
		[Weight] [int] NOT NULL,
		[Quantity] [int] NOT NULL,
		[Price] [decimal](18, 2) NOT NULL,
		[Order_Id] [int] NOT NULL,
		CONSTRAINT [PK_dbo.OrderLine] PRIMARY KEY ([Id])
	)
	CREATE INDEX [IX_Order_Id] ON [dbo].[OrderLine]([Order_Id])
	CREATE TABLE [dbo].[Order] (
		[Id] [int] NOT NULL IDENTITY,
		[UserId] [nvarchar](max),
		[Status] [nvarchar](max),
		[CreatedOn] [datetime] NOT NULL,
		[LastUpdated] [datetime] NOT NULL,
		[ItemsCount] [int] NOT NULL,
		[Weight] [int] NOT NULL,
		[Price] [decimal](18, 2) NOT NULL,
		CONSTRAINT [PK_dbo.Order] PRIMARY KEY ([Id])
	)
	ALTER TABLE [dbo].[OrderLine] ADD CONSTRAINT [FK_dbo.OrderLine_dbo.Order_Order_Id] FOREIGN KEY ([Order_Id]) REFERENCES [dbo].[Order] ([Id]) ON DELETE CASCADE
	CREATE TABLE [dbo].[__MigrationHistory] (
		[MigrationId] [nvarchar](150) NOT NULL,
		[ContextKey] [nvarchar](300) NOT NULL,
		[Model] [varbinary](max) NOT NULL,
		[ProductVersion] [nvarchar](32) NOT NULL,
		CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
	)
	INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
	VALUES (N'201505121543188_Initial', N'DotCommerce.Migrations.Configuration',  0x1F8B0800000000000400ED5ACD6EE33610BE17E83B083AB545D64AB2976D60EF2275922268FE1A27DBDE025A1A3BC452944A52A983A24FD6431FA9AFD0A1FE4549B6E4BF5D14452E32457E331CCE7C9A19E69FBFFE1E7E58F8CC7A012169C047F6D1E0D0B680BB8147F97C64476AF6E69DFDE1FDD75F0DCF3D7F617DCCE6BDD5F370259723FB59A9F0C471A4FB0C3E91039FBA2290C14C0DDCC077881738C78787DF3B47470E20848D589635BC8FB8A23EC43FF0E738E02E842A22EC3AF080C9741CDF4C6254EB86F82043E2C2C83E0BD438F07D102E0C2EF94C10A944E4AA48C0E01C41D5EB85C0C9BF07E2936D9D324A50C309B0996D11CE034514EA7FF22861A244C0E7931007087B780D01E7CD089390EEEBA498DE758B87C77A8B4EB130837223A902BF27E0D1DBD4668EB97C2DCBDBB94DD1AA89A1F4AE63CB8EECF3D9ADF0405C518EFB37E59D8C99D073FBD83EF94D410E4AD0075609E020F726743AFD77608D23A6B1461C2225083BB0EEA229A3EE4FF0FA107C023EE21163E57DE04EF05D650087EE44108250AFF7304B7777E9D996535DE7980BF365A535C9A62FB97A7B6C5B37289C4C19E46E5232D04405027E040E8228F0EE885220B8C680D82A35E9A62C057E210F3D1383CFB6AEC9E20AF85C3D8F6C7CB4AD0BBA002F1B497578E414631517E139401731FA692F82EE0475734967E0529F30DBBA13F89452CD3BDB9AB8441BB4C9BAAB259C51E906C8233B15F20BD0F9B35AE50AAB711E05DB8BD92F7D32877D08DB86617E8E481A1F9BA06CD9D36EC80B9DC7616DC88969CCB6EE81C56FE5330D934F4B46714F39D14934B008FCFB8015DC5A7AFBF440C41CB4F182D629932012AEA1DDD02988BB0B9DEF88CAFFA7F166599855883DD0F804B58DE4CEC58C05682BDCF23CB4F0E703D59F8F9E017A85BEF5187A1A6D632CCD71725CA6FDF548631BF4B557E24969651BEC9351CB12F6C908AA0BFB9C4A19B834D6AA4A3F658DAA5B3DE79EB55ABDC4BF4B5B442F476AA1219209EA81F6B54DD2B8E567C0408175EA2689F6984897787563E35EBC1E3AE5845DD3294999AB7A7D671AAE64A23A6F63F1A308A288D47A67D306DE466E49A95BA6E16B6AAFA126A01A7CA638B626D59D0E404B406A00A5BD16284D3E5A9AD8EEC9E60177F29C7C0F85FA4E2FA0ECB84DA05473D397AA5B6E0899FC888BC2D6492ADBAC02765A4AE0E135094324F852499C8E5893A41E1EBF99F42F08FD04C37165435D986B9B4BC2EF22A695C65B148D9A5E502115D2399912CD6963CFAF4D43876EF1B14C40CD67EBA795795FB6443FA7F1D223932939BE21A2302C4E9FFBF8C58FB70D251758BA3AEE551046444302320E58E4F3B62466E9EAB432AC20A463FD5092C2CFC44946FB21A59F3D132A1DEE8755D470265CF1A61F62F66137F1B2F17E6871256542C5833DCF302FCB6A2799BFE98ED8B4C7FEFB2BAAAF324E31DA1DA9C1235ABD61E818616686BA538BF5DA97BBCA1EDDB965D7BCB23EA7EC8B4FB212A58C908D7547C92A90324A36D61DA5546094814AC3DDB12A254619ADF2A25FCC66658619B1D9F8BEE3F54B8AB26AC6530DB5A65C6F93A8AA00F5F826EB14CF30617BCE58B760A7E84BE09AA227AE30B2D56B699626A16B6AD64F273387AD1F7A2D9535A7E42E97A7B446EA3A4CD3C8D5573CB5BC3299A26BEBE0857A3AA79CBC4A0CC5819E3098FCC6C68C828EC96CC235E1740652250D27FBF8F0E8D8B80DFA726E661C293DD6FD7A66EF8D33AA0DBBB235B6461FA710C15F88709F89F8C6278B6FCB58EB5C6B6C0C56E9EB78FBB8BAD889906A8B2B3EC5CD2E2E3636AC7939B111E0E6DB33AF1FD6C1D8ADAF149F979286B5DED025F76031B2FF88179D5897BF3E65EB0EACF8E9C43AB4FE5C21BCF7DDC27F8387AA3DFB8D1CB2DA97DF08AAD67BD709ACDA52EF7D6DAC7AEF7D9D88D93C6EB71973BB6C6A7FFE1676D2E15DAB698D7018B820745C1186591FE6E998F7D50A093C0CEED2903063EFF5B4B50B1FE86DE588E69B330881EB406FD8641771CB92F51CDBB0F12A1BF4ECEDD73BA6CBBBEF95F35ADEC74F72640C886980479E387CF7367FEE9EED7DFE56019FFB0AA0D2A76FB996688F8E966272274DFE7A05841E56FA5738747149E70584FEC7380E6EC5B7F239583D0799931B1A65530CE2BC064590FDC9A95074465C85AF5D9032BE3FFE4858A44DE34FC1BBE4B7910A23855B067FCA2ABD401D2ACBE4C73719559D87B7617C65B98D2DA09A547FC06EF90F11655EAEF74503B5B740E8184C33087D964A6712F3D71CE926304FBF0D28355F4E1D0FE0870CC1E42D9F90175847374C47AE604EDCD7AC906D07597D1055B30FCF28990BE2CB14A3588F3FD1873D7FF1FE5F933071F4112A0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201505122104370_Corrections1'
BEGIN
	ALTER TABLE [dbo].[Order] ADD [OrderLinesPrice] [decimal](18, 2) NOT NULL DEFAULT 0
	ALTER TABLE [dbo].[Order] ADD [Shipping] [decimal](18, 2) NOT NULL DEFAULT 0
	INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
	VALUES (N'201505122104370_Corrections1', N'DotCommerce.Migrations.Configuration',  0x1F8B0800000000000400ED5ACD6EE33610BE17E83B083AB545D64AB2976D60EF2275B285D1FC354AB6BD2D1869EC104B512A49A5098A3E590F7DA4BE4287FA1725D992FFB62D8A5C648AFC66389CF938A3C95F7FFC397EF71C30EB0984A4219FD847A343DB02EE853EE58B891DABF9AB37F6BBB75F7E313EF78367EB433EEFB59E872BB99CD88F4A45278E23BD4708881C05D413A10CE76AE4858143FCD0393E3CFCD6393A7200216CC4B2ACF16DCC150D20F9813FA721F72052316197A10F4C66E3F8C64D50AD2B12808C880713FB2C54D330084078309AF1B9205289D853B180D13982AA97F70227FF1A8A4FB675CA28410D5D6073DB229C878A28D4FFE45E82AB44C8176E840384DDBD4480F3E68449C8F675524EEFBBC5C363BD45A75C984379B154613010F0E8756633C75CBE96E5EDC2A668D5D4507AD7896527F6F9FC5AF8202E28C7FD9BF24EA64CE8B9436C9FFEA6204715E803AB02705078133A9DFE3BB0A631D358130EB112841D5837F103A3DE0FF072177E023EE13163D57DE04EF05D6D00876E441881502FB730CF7637F36DCBA9AF73CC85C5B2CA9A74D333AE5E1FDBD6150A270F0C0A37A918C855A180EF8183200AFC1BA21408AE3120B14A43BA294B4150CA43CFC4E0B3AD4BF27C017CA11E27363EDAD67BFA0C7E3E92E970CF29C62A2EC273803E62F4D35E04DD08EA1592CEC0A30161B67523F029A39A37B6E57A441BB4CDBAAB259C51E985C8233B15F213D0C5A35AE50AAB71EE05DB8BD9670159C03E846DC3303FC6248B8F4D50B6EC6957E4892E92B036E42434665BB7C092B7F29146E9D59253DCC782E8241A5884C16DC84A6EADBCFD7847C402B4F1C2CE296E180BCFD06EEC94C4DD87CE7744E5FFD378BB2CCC2AC41E68DC456D63B973315301DA0AD7BC082DFC7947F5F53130402FD0B7EE235FA36D8CA5394E4EABB4BF1E696C83BECA68DDED65E722D344C921EF48C05E1934E3C76DD068CE914B683467DA3E347A2A65E8D144AB3A8F5635AA6FF59CFBD66AF5D240AD6C11C315399246C88AA807DAD736D9EF9A9F010305D6A997560C53223DE2378D8D7BF107E854DC3C0D9DD2DCBFAED737A6E12A266A5E4058C529822822B3DED943CB05842499DD4132E321537B0DE5826AF199F2D8DA54777A002D01690054F65AA2B4F9686562B7279B07DCCB738A3D94EA3B8380F2E3368132CD4D5FAA6FB925648A232E2B74272DD1F352DEE9A8E5C7972421B14A6D9F8D586E5AD84F5FB9C32BDB20C5703CD952E016DA1692F082C7FCD8788BA251D3F7544885F71279209AD3A67ED098860EDDE163B98086CF364F2BF7BE7C897ECEE265404A56717C434469589CBE08307549B60D151758BA3AF9E84218112D99D4346471C0BBB2B1A5ABB312B786908D0D43492B5813271D1D86945D7B2654363C0CAB2C464DB8F2CD30C43C4331F1F2F1616849496842258303CFB0A82F1B2759BCE98FD8B6C7E1FB2BCBC82A4E39DA1FA9C5233ABD61EC18616686BAD388F5C6CD5D678FFEDCB26B5E599F53F6C52779AD5545C8C7FAA3E4A55415251FEB8F52A994AA4095E1FE58B55AA98A567B312C66F37AC98CD87C7CDFF1DAA89BAA708D97034EB3A8936AE7598CFE3B79A09E93D5C9A02D1BDD24EE6B4003B2069D841A26ECCE6A9B16ECC50F295C5B7C273550BE7A2DCDB234794DCD86E96466D9CD436F24DBE694C2E58AA4DB48AEC759A2BBBA9BD6C87CD329BAFA0F9FA8AFB35EF74522598CF48491FB0B9B320A9A35F2099784D33948957EDBB38F0F8F8E8DC6DB3FA709E648E9B3FE9DB0BD7FA3A4DAB02BBF42AEF1C9AC14C19F88F01E89F82A20CF5F57B1D6E9206D0C56FBF2E4EFA34BB41321F5AF89C9296ED623DAD8B0661F6823C0CDB767767AD6C1D8ADAF94D74B45C3C6D7AB19F7E17962FF962C3AB1663F7FCCD71D58C9D3897568FDBE42F8E036CE7F8387EAED918D1CB2DE02D908AAD1E6D029B6DA529B636DAC669B639D88D93C6E3B5A1C5B8F3EB3C5B17501DB547F97FD83CFDF2D483FA6AFD51F40386420109A2008C3F4150B0E4C601B15111E06F7684498B1F766FEDD87D8F4B60A44F3CD1944C03563B56CB28FB8655547816DD878950D06B6519A1FA797373A6AE7B5BC659226FB18100F211E79EAF0FD3B2A857B76B7543A057CEE6E4BAD25D2D101EA8E8E8EAA7827FD946629871E56F9F749747149172584FE674A0E5ECDB78A39333E0F73273734CAA718C479098AE035464E85A273E2297CED819409577F202CD6A6091EC09FF1EB5845B1C22D43F0C06A9F5D75A82C939F348DEA3A8FAFA3A43BBC8D2DA09A54DFC4D7FCBB9832BFD0FB7D0BB57740E818CC52217D964AA7448B9702E92A344FBF0B28335F411D7710440CC1E43577C913ACA31BE65517B020DE4B5E917783AC3E88BAD9C767942C0409648651AEC79FE8C37EF0FCF66FC77C5313452C0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201505122146402_ForeignKey'
BEGIN
	EXECUTE sp_rename @objname = N'dbo.OrderLine.Order_Id', @newname = N'OrderId', @objtype = N'COLUMN'
	EXECUTE sp_rename @objname = N'dbo.OrderLine.IX_Order_Id', @newname = N'IX_OrderId', @objtype = N'INDEX'
	INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
	VALUES (N'201505122146402_ForeignKey', N'DotCommerce.Migrations.Configuration',  0x1F8B0800000000000400ED5ADB6EE336107D2FD07F10F4D416592BC9BE6C037B17A9931446736B946CFB1630D2D82196A254924A1D14FDB23EF493FA0B1DEA2ECAB225DF76511479917939331CCE9C2187F9E7AFBF871FE601B35E40481AF2917D3438B42DE05EE8533E1BD9B19ABE79677F78FFF557C3733F985B1FF3716FF5389CC9E5C87E562A3A711CE93D4340E420A09E08653855032F0C1CE287CEF1E1E1F7CED1910308612396650DEF62AE6800C90FFC390EB907918A09BB0A7D60326BC71E3741B5AE490032221E8CECB3508DC32000E1C160C2A7824825624FC50206E708AA5E2F040EFE3D149F6CEB9451821ABAC0A6B645380F1551A8FFC98304578990CFDC081B08BB7F8D00C74D099390ADEBA41CDE758987C77A894E393187F262A9C2A027E0D1DBCC668E397D2DCBDB854DD1AAA9A1F4AA13CB8EECF3E98DF0415C528EEB37E59D8C99D063FBD83EFD4D410E2AD0075605E0A0F026743AFD77608D63A6B1461C6225083BB06EE32746BD9FE0F53EFC047CC463C6AAEBC095605FAD019B6E45188150AF7730CD5637F16DCBA9CF73CC89C5B4CA9C74D113AEDE1EDBD6350A274F0C0A37A918C855A1801F8183200AFC5BA21408AE3120B14A43BA294B4150CA43CFC4E0B3AD2B32BF043E53CF231B3F6DEB82CEC1CF5B321D1E38C558C549B80FD0458CFEDA8BA05B41BD42D219783420CCB66E057E6554F3CEB65C8F68832EB2EE6A0967547A21F2C84E85FC0274F6AC56B9C26A9C07C1F662F6494066B00F61DB30CCCF31C9E2631394DD7A5A425EABC9C000B9262F749670C32238DBBA0396F4CA671AA5F929E7C9C7822D25EE920883BB9095045DE97DBC2762067A07C2D6216E180BCFD06EE894ECDF2527EC281FFC9F0B16CBC2A389D8432E7051DB58EE5CCC5880B6C20D2FE2137FDE539D837AC6E125FAD643E46BB48DB13451CA713577ACC73CDBE0C0325A77CB632E324D946CF28E046C59FDE50C9AF1E3366834E7C825349A336D171A3D9532F468A2559D47AB1AD5977ACE7D6BB57A69A0569688E18A1C49236445D403ED6B9BEC77C3CF808102EBD44BAF1D63223DE2378D8D6BF17BE854649E864EE905A2AED7770D71C8C620341D1286373FCC198472D5A46ECA3D1A11B6D236C6CC8EB4AF975DC8307BCE2002AE197BA511BA082FCE104D0D0A41C686AC32D1D0A9385A338DE31C853340641A9C3D2D48E3986AB24C2E3336377D4043B9A016445EE9FC8B1CC0E900B404A40150596B89B228D22B03DBF9C0DC844EF157ACA154BFB19B9D82C604CA343723B2BEE405C4536C71592C71D26A495E55715ACA2AC32B92A4824A99256BB1DCB4C6327EE3F62F32042986E3C905B58642DB42121E93F0AA62F4A268D4F4820AA930BB9327A233C3D80F1AC3D0A15B7C2C17D0F0D9E66EE5DE974FD1DF59BCF438D8561CBF490619340E9F059A4E92D361C50596CE4EEA5F8411B1E03C3A0E591CF076725B323BAB36D410B2B67E286931C1C4495BFB21658707132A6BEE8755D6054CB8B2A71F627ECE33F1F2F67E68C9EDDC844A1A7BEE6171D56FEC64D1D31D71D11AFBAFAFBCD15771CAD6EE480B3CA2B7371479B78AD29A8C35631AE1DA48D70DCE689CA3EA2CD49DA376CD4FEB73D3BE7829BFF95611F2B6EE28F9C5B68A92B77547A9DC5BAB4095E6EE58B59B6B15ADD6D12FF6F3DBAB19F979FBBEE3BE718B6D445CB5B3C76E16B7D6DA7E16ADBBE1939DF240E3FC660E29A417E738E3BC36CCCE4EABDFCA1A87A97488BE96872FD4D70729F755A2DF0CF48081FB1B1B330ADA81F2015784D329489516DDECE3C3A363E359EDCB79E272A4F459F777AEBD170FA936ECCAF2E01AB5AC52047F21C27B26E29B80CCBFAD62ADF33EB43158AD24E4EFE30D682742EA65BE6417377B01DAD8B0E62BCF46809B2FCF7CC7590763B7BE62BCE2240A36EA2113EEC37C64FF91CC39B126BF3E66D30EACE4E3C43AB4FE5C21BAF7EBCA7F8385EAAF161BB963FD656223A8C6EB833E6BA92DBD3EAC8DD57C7D58275E368FDA969787ADC79EF9F2B07501DB547F9765FDCF5FC44FABB39FA36CBFC7227D4B25EE4B2CCB378B9DCB0BE7B5ED5A5E824F4FFA180F4F21EE78EAEFDD2BF48577B697E85B057CEEEA7DADC4DEF2A2D01E1C2DB5D99DD4E79BF738F4B0CA7F46A2874B3A2B21F4FF4972F06ABE558C99F06998FBB8A1513EC4E0CD2B5004B31839158A4E89A7B0DB032913AAFE4858AC4D133C813FE137B18A62854B86E089D5CA783A5496C94F1E21EA3A0F6FA2E4CD761B4B4035A94EC437FC879832BFD0FB6201B3B740E818CC4E427A2F953E11CD5E0BA4EBD0DCFD36A0CC7C0575DC431031049337DC252FB08E6E78ACBA8419F15EF3EB783BC8EA8DA89B7D7846C94C90406618E57CFC893EEC07F3F7FF02D6AC58DF202C0000 , N'6.1.3-40302')
END

